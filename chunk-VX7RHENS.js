import{a as B}from"./chunk-65C4XMB2.js";import{C as g,D as d,E as l,F as P,G as E,H as x,I as h,J as L,K as N,L as T,N as S,O as u,P as D,Q as _,R as k,Y as p,Z as F,ea as M,fa as A,ga as O,ia as V,ka as Q,l as v,m as I,n as w,o as y,oa as R,s,v as C,z as f}from"./chunk-R52FXVEV.js";var $=["audioPlayer"];function j(n,a){n&1&&(d(0,"div",10)(1,"div",11),P(2,"div",12)(3,"div",13)(4,"div",14),l()())}function q(n,a){if(n&1&&(d(0,"div",15)(1,"p",16),u(2),l()()),n&2){let r,e=h();s(2),D((r=e.error())==null?null:r.message)}}function W(n,a){if(n&1){let r=E();d(0,"div",23)(1,"div",24)(2,"audio",25,0),u(4," Your browser does not support the audio element. "),l(),d(5,"button",26),x("click",function(){I(r);let t=h(2);return w(t.toggleLoop())}),u(6," \u{1F504} Loop "),l()()()}if(n&2){let r=h(2);s(2),g("loop",r.isLooping()),s(3),S(r.isLooping()?"text-white bg-blue-600 border-blue-600":"text-blue-600 bg-white border-blue-600")}}function Y(n,a){if(n&1&&(d(0,"div",27),u(1),l()),n&2){let r=a.$implicit,e=a.index,t=h(2);S(t.getInfoLineClass(r,e)),s(),_(" ",r," ")}}function z(n,a){if(n&1&&(d(0,"div",28),u(1),l()),n&2){let r=a.$implicit;s(),_(" ",r," ")}}function G(n,a){if(n&1&&(d(0,"div",10),f(1,W,7,3,"div",17),d(2,"div",18)(3,"div",19),f(4,Y,2,3,"div",20),l()(),d(5,"div",18)(6,"div",21),f(7,z,2,1,"div",22),l()()()),n&2){let r=h();s(),g("ngIf",r.song().audio),s(3),g("ngForOf",r.getFormattedInfo()),s(3),g("ngForOf",r.getFormattedLyrics())}}var ie=(()=>{let a=class a{constructor(){this.route=v(V),this.router=v(Q),this.musicService=v(B),this.chapterNumber=y(""),this.songIndex=y(0),this.isLooping=y(!1),this.currentIndex=p(()=>this.songIndex()),this.songs=p(()=>{let e=this.chapterNumber();return this.musicService.getSongsForChapter(e)}),this.totalSongs=p(()=>this.songs().length),this.song=p(()=>{let e=this.songs(),t=this.songIndex();return e[t]||null}),this.isLoading=p(()=>{let e=this.chapterNumber();return this.musicService.isChapterLoading(e)}),this.error=p(()=>{let e=this.chapterNumber(),t=this.songs(),i=this.songIndex(),o=this.musicService.getChapterError(e);return o||(!this.isLoading()&&(!t.length||!t[i])?new Error("Slogam not found"):null)}),this.hasPrevious=p(()=>this.songIndex()>0),this.hasNext=p(()=>this.songIndex()<this.songs().length-1),this.route.paramMap.subscribe(e=>{this.chapterNumber.set(e.get("chapterNumber")||""),this.songIndex.set(parseInt(e.get("index")||"0",10))}),F(()=>{this.song()?.audio&&this.audioPlayer?.nativeElement&&this.updateAudioSource()})}ngAfterViewInit(){setTimeout(()=>{this.updateAudioSource()},0)}updateAudioSource(){if(this.audioPlayer?.nativeElement&&this.song()?.audio){let e=this.audioPlayer.nativeElement,t=e.currentTime,i=!e.paused;e.src=this.song().audio,e.load(),e.currentTime=0,i&&e.pause()}}getFormattedInfo(){let e=this.song();if(!e)return[];let t=e.info,i=[],o=t.split(/(\d+\.\d+)/),m="";for(let c=0;c<o.length;c++){let b=o[c].trim();b.match(/^\d+\.\d+$/)?(m.trim()&&i.push(m.trim()),m=b):b&&(m+=" "+b)}return m.trim()&&i.push(m.trim()),i.filter(c=>c.length>0)}getInfoLineClass(e,t){let i=/\d+\.\d+/.test(e),o=t===this.getFormattedInfo().length-1;return i&&!o?"py-3 mb-4 border-b border-gray-100":"py-2"}getFormattedLyrics(){let e=this.song();if(!e)return[];let t=[];return e.song.split(`
`).forEach(o=>{if(o.trim())if(o.includes("\u0964")){let m=o.split("\u0964").map(c=>c.trim()).filter(c=>c.length>0).map(c=>c+(c.endsWith("\u0964")?"":"\u0964"));t.push(...m)}else t.push(o.trim());else t.push("")}),t}toggleLoop(){this.isLooping.set(!this.isLooping())}goBack(){let e=this.chapterNumber();this.router.navigate(["/chapter",e])}goToPrevious(){if(this.hasPrevious()){let e=this.chapterNumber(),t=this.songIndex()-1;this.router.navigate(["/song",e,t])}}goToNext(){if(this.hasNext()){let e=this.chapterNumber(),t=this.songIndex()+1;this.router.navigate(["/song",e,t])}}};a.\u0275fac=function(t){return new(t||a)},a.\u0275cmp=C({type:a,selectors:[["app-song-detail-page"]],viewQuery:function(t,i){if(t&1&&L($,5),t&2){let o;N(o=T())&&(i.audioPlayer=o.first)}},decls:15,vars:8,consts:[["audioPlayer",""],[1,"min-h-screen","bg-gray-50"],[1,"max-w-4xl","mx-auto","px-4","py-8"],[1,"mb-8","flex","items-center","justify-between"],[1,"inline-flex","items-center","px-4","py-2","text-sm","font-medium","text-gray-700","bg-white","border","border-gray-300","rounded-lg","hover:bg-gray-50","transition-colors","duration-150",3,"click"],[1,"flex","items-center","space-x-3"],[1,"px-4","py-2","text-sm","font-medium","text-gray-700","bg-white","border","border-gray-300","rounded-lg","hover:bg-gray-50","disabled:opacity-50","disabled:cursor-not-allowed","transition-colors","duration-150",3,"click","disabled"],[1,"text-sm","text-gray-500","px-2"],["class","space-y-8",4,"ngIf"],["class","text-center py-16",4,"ngIf"],[1,"space-y-8"],[1,"animate-pulse"],[1,"h-8","bg-gray-200","rounded","w-1/2","mb-6"],[1,"h-20","bg-gray-200","rounded","mb-8"],[1,"h-80","bg-gray-200","rounded"],[1,"text-center","py-16"],[1,"text-red-600","text-lg"],["class","bg-white border border-gray-200 rounded-lg p-6 shadow-sm",4,"ngIf"],[1,"bg-white","border","border-gray-200","rounded-lg","p-8","shadow-sm"],[1,"text-gray-800","leading-relaxed","text-lg","space-y-4"],["class","transition-all duration-200",3,"class",4,"ngFor","ngForOf"],[1,"text-gray-800","leading-relaxed","text-base","space-y-6"],["class","py-4 border-b border-gray-100 last:border-b-0",4,"ngFor","ngForOf"],[1,"bg-white","border","border-gray-200","rounded-lg","p-6","shadow-sm"],[1,"flex","items-center","space-x-4"],["controls","",1,"flex-1",3,"loop"],[1,"flex-shrink-0","text-sm","border","px-4","py-2","rounded","hover:bg-blue-700","hover:text-white","transition-colors","duration-150",3,"click"],[1,"transition-all","duration-200"],[1,"py-4","border-b","border-gray-100","last:border-b-0"]],template:function(t,i){t&1&&(d(0,"div",1)(1,"div",2)(2,"div",3)(3,"button",4),x("click",function(){return i.goBack()}),u(4),l(),d(5,"div",5)(6,"button",6),x("click",function(){return i.goToPrevious()}),u(7," \u2190 Previous "),l(),d(8,"span",7),u(9),l(),d(10,"button",6),x("click",function(){return i.goToNext()}),u(11," Next \u2192 "),l()()(),f(12,j,5,0,"div",8)(13,q,3,1,"div",9)(14,G,8,3,"div",8),l()()),t&2&&(s(4),_(" \u2190 Back to Chapter ",i.chapterNumber()," "),s(2),g("disabled",!i.hasPrevious()),s(3),k(" ",i.currentIndex()+1," of ",i.totalSongs()," "),s(),g("disabled",!i.hasNext()),s(2),g("ngIf",i.isLoading()),s(),g("ngIf",i.error()),s(),g("ngIf",i.song()&&!i.isLoading()))},dependencies:[O,M,A,R],encapsulation:2});let n=a;return n})();export{ie as SongDetailPageComponent};
